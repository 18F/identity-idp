postgresql: &postgresql
  adapter: postgresql
  encoding: utf8
  database: upaya_<%= Rails.env %>
  port: 5432
  username: <%= ENV['DOCKER_DB_USER'] %>

defaults: &defaults
  host: <%= ENV['DOCKER_DB_HOST'] || 'localhost' %>
  pool: 5
  <<: *postgresql
  # timeout settings
  timeout: <%= IdentityConfig.store.database_timeout %>
  reconnect: true
  connect_timeout: 2
  keepalives_idle: 10
  keepalives_interval: 10
  keepalives_count: 2
  checkout_timeout: 5
  reaping_frequency: 10
  variables:
    statement_timeout: <%= IdentityConfig.store.database_statement_timeout %>

development:
  primary:
    <<: *defaults
  primary_replica:
    <<: *defaults
    replica: true

test:
  primary: &test
    <<: *defaults
    pool: 10
    checkout_timeout: 10
    database: <%= ENV['POSTGRES_DB'] || "upaya_test#{ENV['TEST_ENV_NUMBER']}" %>
    user: <%= ENV['POSTGRES_USER'] %>
    password: <%= ENV['POSTGRES_PASSWORD'] %>
  primary_replica:
    <<: *test
    replica: true

production:
  primary:
    <<: *defaults
    database: <%= IdentityConfig.store.database_name %>
    username: <%= IdentityConfig.store.database_username %>
    host: <%= IdentityConfig.store.database_host %>
    password: <%= IdentityConfig.store.database_password %>
    pool: <%= IdentityConfig.store.database_pool_idp %>
    sslmode: 'verify-full'
    sslrootcert: '/usr/local/share/aws/rds-combined-ca-bundle.pem'
  primary_replica:
    <<: *defaults
    database: <%= IdentityConfig.store.database_name %>
    username: <%= IdentityConfig.store.database_readonly_username %>
    host: <%= IdentityConfig.store.database_read_replica_host %>
    password: <%= IdentityConfig.store.database_readonly_password %>
    pool: <%= IdentityConfig.store.database_pool_idp %>
    sslmode: 'verify-full'
    sslrootcert: '/usr/local/share/aws/rds-combined-ca-bundle.pem'
    replica: true
