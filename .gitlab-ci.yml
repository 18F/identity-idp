# Jobs defined here use the idp/ci docker image from ECR by default. To find
# other available images:
#   aws ecr describe-repositories | jq '.repositories[].repositoryUri'
# Images are built via the identity-devops GitLab pipeline.

variables:
  GITLAB_CI: 'true'
  FF_SCRIPT_SECTIONS: 'true'
  JUNIT_OUTPUT: 'true'
  ECR_REGISTRY: '${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com'
  IDP_CI_SHA: 'sha256:37766e5b4aaeaad72dc8d18aa73236558ae5abd478073f5005783c44d6d6e87e'
  PKI_IMAGE_TAG: 'main'
  DASHBOARD_IMAGE_TAG: 'main'
  APPLICATION_MANIFEST: dockerfiles/application.yaml


default:
  image: '${ECR_REGISTRY}/idp/ci@${IDP_CI_SHA}'

analyze_job_flakiness:
  stage: test
  script: 
    - ruby --version
    - ruby scripts/analyze-job-flakiness.rb