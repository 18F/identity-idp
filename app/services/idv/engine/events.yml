# This file is used to generate events.rb.

events:
  auth_user_changed_password:
    description: >
      The user has changed their password.
    params:
      type: object
      properties:
        password:
          type: string

  auth_user_reset_password:
    description: >
      The user has reset their password and will not be able to access their IDV PII until providing
      their personal key.

  idv_user_started:
    description: >
      The user has confirmed their desire to begin the identity verification process. They have
      NOT necessarily yet consented to share their PII with Login.gov.

  idv_user_consented:
    description: >
      The user has consented to share PII with Login.gov for the purposes of identity verification.

  idv_documents_submitted_to_acuant:
    description: >
      The user has uploaded identity documents, and Login.gov has submitted them to Acuant for 
      processing.
    params:
      $ref: "#!/schemas/DocAuthResult"

  idv_documents_submitted_to_trueid:
    description: >
      The user has uploaded identity documents, and Login.gov has submitted them to LexisNexis 
      TrueID for processing.
    params:
      $ref: "#!/schemas/DocAuthResult"

  idv_user_entered_password:
    description: >
      The user has entered their password to encrypt their PII.
    params:
      type: object
      properties:
        password:
          type: string

  idv_user_entered_ssn:
    description: >
      The user has entered their Social Security Number (SSN).
    params:
      type: object
      required:
        - ssn
      properties:
        ssn:
          type: string
          description: The user's social security number.

  idv_fraud_threatmetrix_check_initiated:
    description: >
      Login.gov has initiated an automated fraud check for the user using LexisNexis ThreatMetrix.
    params:
      type: object
      properties:
        threatmetrix_session_id:
          type: string
          description: A UUID reported to ThreatMetrix identifying the user's session.

  idv_fraud_threatmetrix_check_completed:
    description: >
      Login.gov requested the result of an automated fraud check.
    params:
      type: object
      properties:
        request_success:
          type: boolean
          description: Did the underlying HTTP request succeed?
        request_timed_out:
          type: boolean
          description: Did the underlying HTTP request time out?
        response_status:
          type: number
          description: >
            HTTP status code returned from ThreatMetrix. (For logging purposes only, not 
            decisional -- use `request_success` to determine if the HTTP request succeeded,
            and `threatmetrix_review_status == 'pass'` to determine if the session passed
            automated fraud checks.
        threatmetrix_session_id:
          type: string
          description: A UUID reported to ThreatMetrix identifying the user's session.
        threatmetrix_review_status:
          type: string
          enum: ["pass", "reject", "review"]
          description: Result of ThreatMetrix review

  idv_user_updated_mailing_address:
    description: >
      The user manually updated their mailing address.
    params:
      type: object
      properties:
        address:
          ref: "#!/schemas/address"

  idv_user_verified_their_info:
    description: >
      The user confirmed the accuracy of the PII on file and chose to continue the IDV process.

  idv_info_submitted_to_aamva:
    description: >
      The information from the user's identity documents was submitted to the American Association
      of Motor Vehicle Administrators (AAMVA) for verification.
    # TODO params

  idv_info_submitted_to_lexisnexis_trueid:
    description: >
      Login.gov made a request to LexisNexis TrueID to verify the user's identity.
    # TODO params

  idv_gpo_user_requested_letter:
    description: The user has requested a letter to verify their address.

  idv_gpo_user_verified_otp:
    description: The user entered the one time password (OTP) they received via US mail.

  idv_residential_address_submitted_to_instantverify:
    description: >
      The user's residential address was submitted to LexisNexis InstantVerify.
      This is used during the In-Person Proofing flow and may be different than the address
      on their identification documents.
    # TODO params

  idv_address_submitted_to_instantverify:
    description: >
      The user's address was submitted to LexisNexis InstantVerify.
    # TODO params

# Shared schemas used across events.
schemas:
  address:
    type: object
    required:
      - line1
      - city
      - state
      - zipcode
    properties:
      line1:
        type: string
      line2:
        type: string
      city:
        type: string
      state:
        type: string
        maxlength: 2
      zipcode:
        type: string

  Alert:
    type: object
    properties:
      name:
        type: string
      result:
        type: string

  DocAuthResult:
    type: object
    properties:
      response_status:
      billed:
        type: boolean
      doc_auth_result:
        type: string
      processed_alerts:
        type: object
        properties:
          passed:
            type: array
            items:
              ref: "#!/schemas/Alert"
          failed:
            type: array
            items:
              ref: "#!/schemas/Alert"
      alert_failure_count:
        type: number
      # log_alert_results: log_alert_formatter.log_alerts(alerts),
      # image_metrics: processed_image_metrics,
      # tamper_result: tamper_result_code&.name,
      # classification_info: classification_info,
      address_line2_present:
        type: boolean
