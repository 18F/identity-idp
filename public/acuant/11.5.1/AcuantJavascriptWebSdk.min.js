var AcuantConfig=function(){"use strict";return{acuantVersion:"11.5.1",cvmlVersion:"4.3.4"}}(),config={};"undefined"!=typeof acuantConfig&&0!==Object.keys(acuantConfig).length&&acuantConfig.constructor===Object&&(config=acuantConfig),document.addEventListener("DOMContentLoaded",(function(){void 0===AcuantJavascriptWebSdk&&loadAcuantSdk(),document.removeEventListener("DOMContentLoaded",this)}));var AcuantJavascriptWebSdk=void 0;function loadAcuantSdk(){AcuantJavascriptWebSdk=function(e){var t={ACUANT_IMAGE_WORKER:"AcuantImageWorker",ACUANT_METRICS_WORKER:"AcuantMetricsWorker",SEQUENCE_BREAK_CODE:SEQUENCE_BREAK_CODE="sequence-break",START_FAIL_CODE:START_FAIL_CODE="start-fail",REPEAT_FAIL_CODE:REPEAT_FAIL_CODE="repeat-fail",startInitializer:function(t,n=0){if(t){if(!d){b(i,t);let a=null;e&&e.cdnPath&&e.cdnPath.initializerUrl?a=e.cdnPath.initializerUrl:e.path&&(a=e.path),d=new Worker(W(a,"AcuantInitializerWorker.min.js",n)),d.onmessage=E}}else T("startInitializer did not have a user callback set")},endInitializer:function(){d&&(d.terminate(),d.onmessage=null,h=!1,d=null)},startWorkers:function(t,i=[this.ACUANT_IMAGE_WORKER,this.ACUANT_METRICS_WORKER],a=0){if(t){if(b(n,t),i.includes(this.ACUANT_IMAGE_WORKER)&&!f){let t=null;e&&e.cdnPath&&e.cdnPath.imageUrl?t=e.cdnPath.imageUrl:e.path&&(t=e.path),A++,f=new Worker(W(t,"AcuantImageWorker.min.js",a)),f.onmessage=v}if(i.includes(this.ACUANT_METRICS_WORKER)&&!m){let t=null;e&&e.cdnPath&&e.cdnPath.metricsUrl?t=e.cdnPath.metricsUrl:e.path&&(t=e.path),A++,m=new Worker(W(t,"AcuantMetricsWorker.min.js",a)),m.onmessage=w}}else T("startWorkers did not have a user callback set")},endWorkers:function(e=[this.ACUANT_IMAGE_WORKER,this.ACUANT_METRICS_WORKER]){e.includes(this.ACUANT_IMAGE_WORKER)&&f&&(f.terminate(),f.onmessage=null,g=!1,f=null),e.includes(this.ACUANT_METRICS_WORKER)&&m&&(m.terminate(),m.onmessage=null,k=!1,m=null)},initialize:function(e,t,i,n=0){i?(b(a,i),d?x(d,"initialize",{creds:e,endpoint:t}):this.startInitializer((()=>{x(d,"initialize",{creds:e,endpoint:t})}),n)):T("initialize did not have a user callback set")},initializeWithToken:function(e,t,i,n=0){i?(b(a,i),d?x(d,"initializeWithToken",{token:e,endpoint:t}):this.startInitializer((()=>{x(d,"initializeWithToken",{token:e,endpoint:t})}),n)):T("initializeWithToken did not have a user callback set")},crop:function(e,t,i,n){n?g&&null!=e?(b(r,n),x(f,"crop",{imgData:e.data,width:t,height:i})):n.onFail():T("crop did not have a user callback set")},detect:function(e,t,i,n){n?g&&null!=e?(b(o,n),x(f,"detect",{imgData:e.data,width:t,height:i})):n.onFail():T("detect did not have a user callback set")},metrics:function(e,t,i,n){n?k&&null!=e?(b(c,n),x(m,"metrics",{imgData:e.data,width:t,height:i})):n.onFail():T("metrics did not have a user callback set")},moire:function(e,t,i,n){n?k&&null!=e?(b(s,n),x(m,"moire",{imgData:e.data,width:t,height:i})):n.onFail():T("moire did not have a user callback set")},setUnexpectedErrorCallback:function(e){b(l,e)}};const i="initStart",n="workersStart",a="init",r="crop",o="detect",c="metrics",s="moire",l="unexpectedError";let u=!1,d=null,h=!1,f=null,g=!1,m=null,k=!1,A=0,p={},y={};function E(e){if(u=!1,e){let r=e.data;if(h)if(r&&"initialize"===r.func){let e=r.status;var n=p[a];t.endInitializer(),n?1==e?(u=!0,n.onSuccess()):n.onFail(e,function(e){switch(e){case 401:return"Server returned a 401 (missing credentials).";case 403:return"Server returned a 403 (invalid credentials).";case 400:return"Server returned a 400.";case 2:return"Token Validation Failed (Recieved token, but token was null/corrupt).";case 3:return"Token Validation Failed (Recieved token, but token was missing part of body).";case 4:return"Token Validation Failed (Recieved token, but token body was missing fields).";case 5:return"Token Validation Failed (Recieved token, but token body failed validation).";case 6:return"At least one param was null/invalid.";case 7:return"Incorrectly formatted message to worker.";default:return"Unexpected error code."}}(e)):T("initialize did not have a user callback set")}else T("initworker sent message without correct function tagging");else{h=!0;let e=p[i];e&&e()}}else T("initworker sent message without anything in the body")}function v(e){if(e){let i=e.data;if(g)if(i&&"detect"===i.func)(t=p[o])?i.type&&i.x1&&i.y1&&i.x2&&i.y2&&i.x3&&i.y3&&i.x4&&i.y4?function(e,t,i,n,a,r,o,c,s,l){if(l)if(-1==e)l.onFail();else{let u=function(e,t,i,n,a,r,o,c){let s={x:e,y:t},l={x:i,y:n},u={x:a,y:r},d={x:o,y:c},h=C(s,l),f=C(l,u),g=C(u,d),m=C(d,s),k=(h+g)/2,A=(f+m)/2;return k>A?{width:k,height:A}:{width:A,height:k}}(t,i,n,a,r,o,c,s),d=function(e,t){var i=!1;let n=5,a=1.42,r=1.5887;if(2==t){let t=(100+n)/100*a;e>=(100-n)/100*a&&e<=t&&(i=!0)}else if(1==t){let t=(100+n)/100*r;e>=(100-n)/100*r&&e<=t&&(i=!0)}return i}(u.width/u.height,e),h=_(u.width,u.height,2==e),f=function(e){var t=[-1,-1,-1,-1];e&&4===e.length&&(R(t,e[0],e[2]),R(t,e[1],e[3]));return t}([{x:t,y:i},{x:n,y:a},{x:r,y:o},{x:c,y:s}]);l.onSuccess({type:e,dimensions:u,dpi:h,isCorrectAspectRatio:d,points:f})}}(i.type,i.x1,i.y1,i.x2,i.y2,i.x3,i.y3,i.x4,i.y4,t):t.onFail():T("detect did not have a user callback set");else if("crop"===i.func){var t;(t=p[r])?i.imgData&&i.width&&i.height&&i.type?function(e,t,i,n,a){a&&(null!=e&&t>=0&&i>=0&&n>=0?(y={image:{data:e,width:t,height:i},cardtype:n,dpi:_(t,i,2==n)},a.onSuccess(y)):a.onFail())}(i.imgData,i.width,i.height,i.type,t):i.error?t.onFail(i.error):t.onFail():T("crop did not have a user callback set")}else T("imageworker sent message without correct function tagging");else g=!0,S()}else T("imageworker sent message without anything in the body")}function w(e){if(e){let i=e.data;if(k)if(i&&"metrics"===i.func)(t=p[c])?i.sharpness&&i.glare?function(e,t,i){if(i)if(t>=0&&e>=0){let n=Math.floor(100*e),a=Math.floor(100*t);i.onSuccess(n,a)}else i.onFail()}(i.sharpness,i.glare,t):i.error?t.onFail(i.error):t.onFail():T("metrics did not have a user callback set");else if("moire"===i.func){var t;(t=p[s])?i.moire&&i.moireraw?function(e,t,i){if(i)if(e>=0&&t>=0){let n=Math.floor(100*e),a=Math.floor(100*t);i.onSuccess(n,a)}else i.onFail()}(i.moire,i.moireraw,t):i.error?t.onFail(i.error):t.onFail():T("moire did not have a user callback set")}else T("metricsworker sent message without correct function tagging");else k=!0,S()}else T("metricsworker sent message without anything in the body")}function R(e,t,i){return t.x<i.x&&t.y<i.y?(e[0]=t,e[2]=i):t.x>i.x&&t.y>i.y?(e[0]=i,e[2]=t):t.x>i.x&&t.y<i.y?(e[1]=t,e[3]=i):(e[1]=i,e[3]=t),e}function C(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function _(e,t,i){let n=e>t?e:t,a=i?4.92:3.37;return Math.round(n/a)}function b(e,t){p[e]=t}function T(e){let t=p[l];t?e?t(e):t():console.error("Error: ",e)}function W(e,t,i){let n;return null!=e&&e.length>0&&0==i?(n="/"===e.charAt(e.length-1)?e:e+"/",n+=t):n=0!=i?e:t,n}function x(e,t,i){var n={func:t,data:i};i&&i.imgData&&i.imgData.data?e.postMessage(n,[n.data.imgData.data]):e.postMessage(n)}function S(){let e=p[n];A--,0==A&&e&&e()}return t}(config),"function"==typeof onAcuantSdkLoaded&&onAcuantSdkLoaded()}