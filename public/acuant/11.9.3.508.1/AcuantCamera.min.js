var AcuantCameraUI=function(){"use strict";let e=null,t=null,i=null,a=null,n={start:function(e,i){s=e.onError,i&&(m=i,m.text.hasOwnProperty("BIG_DOCUMENT")||(m.text.BIG_DOCUMENT="TOO CLOSE"));AcuantCamera.isCameraSupported?r||(r=!0,v(),function(e){let i=0,n=(new Date).getTime();a=document.getElementById("acuant-camera"),a&&a.addEventListener("acuantcameracreated",C);AcuantCamera.start((a=>{!function(e,t){if(t>=3)return!0;{let t=(new Date).getTime()-e;return t<p&&(p=t),p<f}}(n,i)?(i+=1,n=(new Date).getTime(),AcuantCamera.setRepeatFrameProcessor()):p<f?function(e,t){if(e){if(o&&-1===o.state)return;t.onFrameAvailable&&t.onFrameAvailable(e),o=e,o.state===AcuantCamera.DOCUMENT_STATE.GOOD_DOCUMENT?null===l&&(c=(new Date).getTime(),function(e){null===l&&(l=setTimeout((function(){o.state=h.CAPTURING,A(e,"AUTO")}),g))}(t)):(y(),c=null)}else y(),c=null}(a,e):function(e){o={state:h.TAP_TO_CAPTURE},t.addEventListener("click",T,!1),t.callback=e}(e)}),e,E)}(e)):E("Camera not supported.",AcuantJavascriptWebSdk.START_FAIL_CODE)},end:w},r=!1,o=null,c=null,d=null,s=null,l=null,u=null;const h={CAPTURING:-1,TAP_TO_CAPTURE:-2};let m={text:{NONE:"ALIGN",SMALL_DOCUMENT:"MOVE CLOSER",GOOD_DOCUMENT:null,BIG_DOCUMENT:"TOO CLOSE",CAPTURING:"CAPTURING",TAP_TO_CAPTURE:"TAP TO CAPTURE"}};const g=3e3,f=400;let p=Number.MAX_VALUE;function v(){o=null,c=null,d=null}function w(){v(),r=!1,l&&(clearTimeout(l),l=null),u&&(clearTimeout(u),u=null),e&&(e.removeEventListener("play",b,0),e=null),a&&a.removeEventListener("acuantcameracreated",C),t&&(t.removeEventListener("click",T),t.getContext("2d").clearRect(0,0,t.width,t.height)),AcuantCamera.end()}function y(){l&&(clearTimeout(l),l=null)}function T(e){A(e.currentTarget.callback,"TAP")}function C(){e=document.getElementById("acuant-player"),t=document.getElementById("acuant-ui-canvas"),i=t.getContext("2d"),t.setAttribute("role","img"),e.addEventListener("play",b,0)}function A(e,t){AcuantCamera.triggerCapture((i=>{w(),e.onCaptured(i),AcuantCamera.evaluateImage(i.data,i.width,i.height,i.isPortraitOrientation,t,(t=>{e.onCropped(t)}))}))}function E(e,t){w(),s&&s(e,t),s=null}function b(){!function a(){e&&!e.paused&&!e.ended&&r&&(!function(){if(i.clearRect(0,0,t.width,t.height),o)if(o.state===h.CAPTURING)D("#00ff00"),M("rgba(0, 255, 0, 0.2)"),x(m.text.CAPTURING,.05,"#00ff00",!1);else if(o.state===h.TAP_TO_CAPTURE)D("#000000"),x(m.text.TAP_TO_CAPTURE);else if(o.state===AcuantCamera.DOCUMENT_STATE.GOOD_DOCUMENT)if(D("#ffff00"),M("rgba(255, 255, 0, 0.2)"),m.text.GOOD_DOCUMENT)x(m.text.GOOD_DOCUMENT,.09,"#ff0000",!1);else{let e=Math.ceil((g-((new Date).getTime()-c))/1e3);e<=0&&(e=1),x(e+"...",.09,"#ff0000",!1)}else o.state===AcuantCamera.DOCUMENT_STATE.SMALL_DOCUMENT?(D("#ff0000"),x(m.text.SMALL_DOCUMENT)):o.state===AcuantCamera.DOCUMENT_STATE.BIG_DOCUMENT?(D("#ff0000"),x(m.text.BIG_DOCUMENT)):(D("#000000"),x(m.text.NONE));else D("#000000"),x(m.text.NONE)}(),u=setTimeout(a,100))}()}function x(e,t=.04,a="#ffffff",n=!0){let r=S(),o=window.orientation,c=i.measureText(e),d=.01*Math.max(r.width,r.height),s=.02*Math.max(r.width,r.height),l=(r.height-s-c.width)/2,u=-(r.width/2-d),h=90;0!==o&&(h=0,l=(r.width-d-c.width)/2,u=r.height/2-s+.04*Math.max(r.width,r.height)),i.rotate(h*Math.PI/180),n&&(i.fillStyle="rgba(0, 0, 0, 0.5)",i.fillRect(Math.round(l-d),Math.round(u+d),Math.round(c.width+s),-Math.round(.05*Math.max(r.width,r.height)))),i.font=(Math.ceil(Math.max(r.width,r.height)*t)||0)+"px Sans-serif",i.fillStyle=a,i.fillText(e,l,u),O(e),i.rotate(-h*Math.PI/180)}const O=e=>{d||(d=document.createElement("p"),d.id="doc-state-text",d.style.height="1px",d.style.width="1px",d.style.margin="-1px",d.style.overflow="hidden",d.style.position="absolute",d.style.whiteSpace="nowrap",d.setAttribute("role","alert"),d.setAttribute("aria-live","assertive"),t.parentNode.insertBefore(d,t)),d.innerHTML!=e&&(d.innerHTML=e)};function S(){return{height:t.height,width:t.width}}function k(e,t){let a=window.orientation,n=S(),r=.08*n.width,o=.07*n.height;switch(0!==a&&(r=.07*n.width,o=.08*n.height),t.toString()){case"1":r=-r;break;case"2":r=-r,o=-o;break;case"3":o=-o}!function(e,t,a){i.beginPath();const n=Math.round(e.x),r=Math.round(e.y);i.moveTo(n,r),i.lineTo(Math.round(n+t),r),i.moveTo(n,r),i.lineTo(n,Math.round(r+a)),i.stroke()}(e,r,o)}function M(e){if(o&&o.points&&4===o.points.length){i.beginPath(),i.moveTo(Math.round(o.points[0].x),Math.round(o.points[0].y));for(let e=1;e<o.points.length;e++)i.lineTo(Math.round(o.points[e].x),Math.round(o.points[e].y));i.fillStyle=e,i.strokeStyle="rgba(0, 0, 0, 0)",i.stroke(),i.fill()}}function D(e){let t=S();if(i.lineWidth=Math.ceil(.0025*Math.max(t.width,t.height))||1,i.strokeStyle=e,o&&o.points&&(-1===o.state||o.state===AcuantCamera.DOCUMENT_STATE.GOOD_DOCUMENT))for(let e in o.points)k(o.points[e],e);else{let e,i,a,n,r={x:t.width/2,y:t.height/2};t.width>t.height?(a=.85*t.width,n=.85*t.width/1.5887,n>.85*t.height&&(a=a/n*.85*t.height,n=.85*t.height)):(a=.85*t.height/1.5887,n=.85*t.height,a>.85*t.width&&(n=n/a*.85*t.width,a=.85*t.width)),e=a/2,i=n/2,[{x:r.x-e,y:r.y-i},{x:r.x+e,y:r.y-i},{x:r.x+e,y:r.y+i},{x:r.x-e,y:r.y+i}].forEach(((e,t)=>{k(e,t)}))}}return n}(),AcuantCamera=(()=>{"use strict";let e=null,t=null,i=null,a=null,n=null,r=null;const o="Camera capture failed due to unexpected sequence break. This usually indicates the camera closed or froze unexpectedly. In iOS 15+ this is intermittently occurs due to a GPU Highwater failure. Swap to manual capture until the user fully reloads the browser. Attempting to continue to use live capture can lead to further Highwater errors and can cause to OS to cut off the webpage.",c="Camera capture failed due to unexpected sequence break. This usually indicates the camera closed or froze unexpectedly. Swap to manual capture until the user fully reloads the browser.",d={NO_DOCUMENT:0,SMALL_DOCUMENT:1,BIG_DOCUMENT:2,GOOD_DOCUMENT:3},s={NONE:0,ID:1,PASSPORT:2},l=700,u=500,h=1920;let m,g,f=null,p=null,v=null,w=!1,y=!1,T=null,C={start:D,startManualCapture:I,triggerCapture:function(t){let i,a;try{if(0==e.videoWidth)throw"width 0";n.width=e.videoWidth,n.height=e.videoHeight,r.drawImage(e,0,0,n.width,n.height),i=r.getImageData(0,0,n.width,n.height),r.clearRect(0,0,n.width,n.height),a=window.matchMedia("(orientation: portrait)").matches}catch(e){return void re()}t({data:i,width:n.width,height:n.height,isPortraitOrientation:a})},end:P,DOCUMENT_STATE:d,ACUANT_DOCUMENT_TYPE:s,isCameraSupported:"mediaDevices"in navigator&&function(){let e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),(e||E())&&!A()}(),isIOSWebview:function(){const e=window.navigator.standalone,t=window.navigator.userAgent.toLowerCase(),i=/safari/.test(t);return/iphone|ipod|ipad/.test(t)&&!i&&!e}(),isIOS:E,setRepeatFrameProcessor:te,evaluateImage:q};function A(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function E(){return/iPad|iPhone|iPod/.test(navigator.platform)&&R()[0]>=13||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1}function b(){let e;e=g||navigator.userAgent;const t=e.match(/SM-[N|G|S]\d{3}/);if(!t)return!1;const i=parseInt(t[0].match(/\d{3}/)[0],10),a=e.match(/SM-S\d{3}/)?900:970;return!isNaN(i)&&i>=a}const x=function(){let e={frameScale:1,primaryConstraints:{video:{facingMode:{exact:"environment"},aspectRatio:4/3,resizeMode:"none"}},fixedHeight:null,fixedWidth:null};E()?z()?(e.primaryConstraints.video.aspectRatio=1*Math.max(window.innerWidth,window.innerHeight)/Math.min(window.innerWidth,window.innerHeight),e.primaryConstraints.video.height={min:1440,ideal:2880}):L()?e.primaryConstraints.video.width={min:h,ideal:h}:e.primaryConstraints.video.height={min:1440,ideal:1440}:e.primaryConstraints.video.height={min:1440,ideal:1440};return e}();function O(t){Q().then((()=>{w=!0,e.srcObject=t,function(){b()&&document.addEventListener("visibilitychange",J);window.addEventListener("resize",B),e&&(e.addEventListener("play",V),e.addEventListener("loadedmetadata",j))}(),e.play()}))}function S(e,t){document.cookie="AcuantCameraHasFailed="+t,P(),p&&"function"==typeof p?p(e,t):(console.error("No error callback set. Review implementation."),console.error(e,t))}function k(){return new Promise((e=>{navigator.mediaDevices.enumerateDevices().then((t=>{const i={suffix:void 0,device:void 0},a=t.find((e=>"Back Dual Wide Camera"===e.label));(function(){let e=R();return e&&-1!=e&&e.length>=1&&16==e[0]&&e[1]>=4})()&&a?i.device=a:t.filter((e=>"videoinput"===e.kind)).forEach((e=>{if(t=e.label,["rear","back","rück","arrière","trasera","trás","traseira","posteriore","后面","後面","背面","задней","الخلفية","후","arka","achterzijde","หลัง","baksidan","bagside","sau","bak","tylny","takakamera","belakang","אחורית","πίσω","spate","hátsó","zadní","darrere","zadná","задня","stražnja","belakang","बैक"].some((e=>t.includes(e)))){let t=e.label.split(","),a=parseInt(t[0][t[0].length-1]);(a||0===a)&&(void 0===i.suffix||i.suffix>a)&&(i.suffix=a,i.device=e)}var t})),e(i.device)})).catch((()=>{e()}))}))}function M(e,t=0){0===t&&m.dispatchEvent(new Event("acuantcameracreated"));const i=Boolean(e.video.deviceId);navigator.mediaDevices.getUserMedia(e).then((e=>{!i&&t<2?k().then((i=>{i&&i.deviceId!==e.getVideoTracks()[0].getSettings().deviceId?(x.primaryConstraints.video.deviceId=i.deviceId,N(e),M(x.primaryConstraints,t++)):O(e)})):O(e)})).catch((e=>{S(e,AcuantJavascriptWebSdk.START_FAIL_CODE)}))}function D(a,o,c){if(c&&(p=c),function(){let e="AcuantCameraHasFailed=";return decodeURIComponent(document.cookie).includes(e)}())return c("Live capture has previously failed and was called again. User was sent to manual capture.",AcuantJavascriptWebSdk.REPEAT_FAIL_CODE),void I(o);m=document.getElementById("acuant-camera"),m?(m.style.position="relative",m.innerHTML='<video id="acuant-player" autoplay playsinline style="display:block; image-orientation:none; object-fit: fill;"></video><canvas id="acuant-ui-canvas" style="display:block; position:absolute; top:0; left:0;"></canvas>',e=document.getElementById("acuant-player"),n=document.createElement("canvas"),r=n.getContext("2d",{willReadFrequently:!E()}),t=document.getElementById("acuant-ui-canvas"),w?S("already started.",AcuantJavascriptWebSdk.START_FAIL_CODE):e&&t?(i=t.getContext("2d"),a&&(f=a),navigator.userAgentData&&navigator.userAgentData.getHighEntropyValues?navigator.userAgentData.getHighEntropyValues(["model"]).then((e=>{"string"==typeof e?g=e:"string"==typeof e.model&&(g=e.model)})).finally((()=>{b()?x.primaryConstraints.video.zoom=2:H()&&(x.primaryConstraints.video.zoom=1.6),M(x.primaryConstraints)})):(b()?x.primaryConstraints.video.zoom=2:H()&&(x.primaryConstraints.video.zoom=1.6),M(x.primaryConstraints))):S("Missing HTML elements.",AcuantJavascriptWebSdk.START_FAIL_CODE)):S("Expected div with 'acuant-camera' id",AcuantJavascriptWebSdk.START_FAIL_CODE)}function I(e){v=e,a||(a=document.createElement("input"),a.type="file",a.capture="environment",a.accept="image/*",a.onclick=function(e){e&&e.target&&(e.target.value="")}),a.onchange=_,a.click()}let U=-1;function _(e){n=document.createElement("canvas"),r=n.getContext("2d"),r.mozImageSmoothingEnabled=!1,r.webkitImageSmoothingEnabled=!1,r.msImageSmoothingEnabled=!1,r.imageSmoothingEnabled=!1;let t=e.target,i=new FileReader;const a=e.target.files[0]&&e.target.files[0].name&&e.target.files[0].name.toLowerCase().endsWith(".heic");i.onload=a?e=>{var t;(t=e.target.result,new Promise(((e,i)=>{const a=window["magick-wasm"];a?a.initializeImageMagick().then((()=>{a.ImageMagick.read(new Uint8Array(t),(t=>{const{width:i,height:a}=W(t.width,t.height);n.width=i,n.height=a,t.resize(i,a),t.writeToCanvas(n);const o=r.getImageData(0,0,i,a);e({data:o,width:i,height:a})}))})):i({error:"HEIC image processing failed. Please make sure Image Magick scripts were integrated as expected.",code:AcuantJavascriptWebSdk.HEIC_NOT_SUPPORTED_CODE})}))).then((e=>{U=6,v.onCaptured(e),q(e.data,e.width,e.height,!1,"MANUAL",v.onCropped)})).catch((e=>v.onError(e.error,e.code)))}:e=>{U=function(e){const t=new DataView(e.target.result);if(65496!=t.getUint16(0,!1))return-2;const i=t.byteLength;let a=2;for(;a<i;){if(t.getUint16(a+2,!1)<=8)return-1;const e=t.getUint16(a,!1);if(a+=2,65505==e){if(1165519206!=t.getUint32(a+=2,!1))return-1;const e=18761==t.getUint16(a+=6,!1);a+=t.getUint32(a+4,e);const i=t.getUint16(a,e);a+=2;for(let n=0;n<i;n++)if(274==t.getUint16(a+12*n,e))return t.getUint16(a+12*n+8,e)}else{if(65280!=(65280&e))break;a+=t.getUint16(a,!1)}}return-1}(e);let t=document.createElement("img");t.onload=()=>{const{width:e,height:i}=W(t.width,t.height);n.width=e,n.height=i,r.drawImage(t,0,0,e,i);const a=r.getImageData(0,0,e,i);r.clearRect(0,0,e,i),t.remove(),v.onCaptured({data:a,width:e,height:i}),q(a,e,i,!1,"MANUAL",v.onCropped)},t.src="data:image/jpeg;base64,"+oe(e.target.result)},t&&t.files[0]&&i.readAsArrayBuffer(t.files[0])}function W(e,t){let i=2560,a=1920;L()&&(i=h,a=Math.floor(3*h/4));if((e>t?e:t)>i)if(e<t){a=i,i=a/(t/e)}else{a=i/(e/t)}else i=e,a=t;return{width:i,height:a}}function N(e){e.getTracks().forEach((e=>{e.stop()}))}function P(){w=!1,y=!1,U=-1,T&&(clearTimeout(T),T=null),function(){b()&&document.removeEventListener("visibilitychange",J);window.removeEventListener("resize",B),e&&(e.removeEventListener("play",V),e.removeEventListener("loadedmetadata",j))}(),e&&(e.pause(),e.srcObject&&N(e.srcObject),e=null),m&&(m.innerHTML=""),a&&(a.remove(),a=null)}function R(){if(/iP(hone|od|ad)/.test(navigator.platform))try{const e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]}catch(e){return-1}return-1}function L(){let e=R();return e&&-1!=e&&e.length>=1&&15==e[0]}function H(){let e=R();return e&&-1!=e&&e.length>=1&&e[0]>=17}function z(){let e=decodeURIComponent(document.cookie);if(e.includes("AcuantForceRegularCapture=true"))return!1;if(e.includes("AcuantForceDistantCapture=true"))return!0;if(function(){let e=R();return e&&-1!=e&&e.length>=1&&16==e[0]&&e[1]<4}()){let e=[screen.width,screen.height],t=Math.max(...e),i=Math.min(...e);if(852==t&&393==i)return!0;if(932==t&&430==i)return!0;if(844==t&&390==i)return!0;if(926==t&&428==i)return!0}return!1}function B(){i.clearRect(0,0,t.width,t.height),e&&(E()&&(function(){const e=window.navigator.userAgent,t=e.indexOf("WebKit")>-1,i=e.indexOf("CriOS")>-1;return t&&i&&E()}()||function(){let e=R();return e&&-1!=e&&e.length>=2&&14==e[0]&&e[1]>=4}())?(P(),D()):F())}function F(){let i,a;if(e.videoWidth<e.videoHeight?x.canvasScale=e.videoHeight/e.videoWidth:x.canvasScale=e.videoWidth/e.videoHeight,i=window.innerWidth,a=window.innerHeight,x.fixedHeight||(x.fixedHeight=m.clientHeight),x.fixedWidth||(x.fixedWidth=m.clientWidth),x.fixedHeight&&x.fixedWidth&&x.fixedWidth>x.fixedHeight&&(x.fixedHeight=m.clientWidth,x.fixedWidth=m.clientHeight),window.matchMedia("(orientation: portrait)").matches){if(x.fixedWidth)x.fixedWidth<i&&(i=x.fixedWidth),a=i*x.canvasScale;else if(x.fixedHeight){let e=x.fixedHeight/x.canvasScale;e<i&&(a=x.fixedHeight,i=e)}}else if(x.fixedWidth)x.fixedWidth<a&&(a=x.fixedWidth),i=a*x.canvasScale;else if(x.fixedHeight){let e=x.fixedHeight/x.canvasScale;e<a&&(i=x.fixedHeight,a=e)}e.width=t.width=i,e.height=t.height=a}function J(){!a&&w&&"visible"===document.visibilityState&&(P(),D())}function G(){e&&!e.paused&&(te(),T=setTimeout(G,100))}function j(){e.videoWidth+e.videoHeight<1e3?(P(),S("Camera not supported",AcuantJavascriptWebSdk.START_FAIL_CODE)):(F(),G())}function V(){T&&(clearTimeout(T),y=!1,G())}function q(e,t,i,a,n,r){AcuantJavascriptWebSdk.singleWorkerModel?async function(e,t,i,a,n){let r={isPortraitOrientation:n};await Q();const o=await X(e,t,i);if(!o)return null;r={...r,...o},K(),await new Promise((e=>{AcuantJavascriptWebSdk.startMetricsWorker(e)}));const c=await Y(e,t,i),d=await Z(r.image);r={...r,...c,...d},AcuantJavascriptWebSdk.endMetricsWorker();const{imageBase64:s,imageBytes:l}=ie(r,a);r.image.bytes=l;const u=await ee(s);r.image.barcodeText=u;const h=await ae(r,a,s);await Q();const m=await $(h);return r.image.data=m,K(),r}(e,t,i,n,a).then(r):async function(e,t,i,a,n){let r={isPortraitOrientation:n};const[o,c]=await Promise.all([X(e,t,i),Y(e,t,i)]);if(!o)return null;r={...r,...o};const d=await Z(r.image);r={...r,...c,...d};const{imageBase64:s,imageBytes:l}=ie(r,a);r.image.bytes=l;const u=await ee(s);r.image.barcodeText=u;const h=await ae(r,a,s),m=await $(h);return r.image.data=m,r}(e,t,i,n,a).then(r)}function Q(){return new Promise((e=>{AcuantJavascriptWebSdk.startImageWorker(e)}))}function K(){AcuantJavascriptWebSdk.endImageWorker()}function X(e,t,i){return new Promise((a=>{AcuantJavascriptWebSdk.crop(e,t,i,{onSuccess:({image:e,dpi:t,cardType:i})=>a({image:e,dpi:t,cardType:i}),onFail:a})}))}function Y(e,t,i){return new Promise((a=>{AcuantJavascriptWebSdk.moire(e,t,i,{onSuccess:(e,t)=>a({moire:e,moireraw:t}),onFail:()=>a({moire:-1,moireraw:-1})})}))}function Z(e){return new Promise((t=>{AcuantJavascriptWebSdk.metrics(e,e.width,e.height,{onSuccess:(e,i)=>t({sharpness:e,glare:i}),onFail:()=>t({sharpness:-1,glare:-1})})}))}function $(e){return new Promise((t=>{const i=function(e){const t=window.atob(e.split("base64,")[1]),i=t.length,a=new Uint8Array(new ArrayBuffer(i));for(let e=0;e<i;e++)a[e]=t.charCodeAt(e);return a}(e);AcuantJavascriptWebSdk.sign(i,{onSuccess:e=>t("data:image/jpeg;base64,"+oe(e)),onFail:t})}))}async function ee(e){if(!document.getElementById(AcuantJavascriptWebSdk.BARCODE_READER_ID))return null;try{return await function(e){let t=e.split(","),i=t[0].match(/:(.*?);/)[1],a=atob(t[1]),n=a.length,r=new Uint8Array(n);for(;n--;)r[n]=a.charCodeAt(n);const o=new File([r],"imageFile",{type:i});return new Html5Qrcode(AcuantJavascriptWebSdk.BARCODE_READER_ID,{formatsToSupport:[Html5QrcodeSupportedFormats.PDF_417]}).scanFile(o,!1)}(e)}catch{return null}}function te(){if(!w||y)return;if(0==e.videoWidth)return void re();y=!0;let t=Math.max(e.videoWidth,e.videoHeight),i=Math.min(e.videoWidth,e.videoHeight),a=0,o=0;if(t>l&&i>u?e.videoWidth>=e.videoHeight?(x.frameScale=l/e.videoWidth,o=l,a=e.videoHeight*x.frameScale):(x.frameScale=l/e.videoHeight,o=e.videoWidth*x.frameScale,a=l):(x.frameScale=1,o=e.videoWidth,a=e.videoHeight),o==n.width&&a==n.height||(n.width=o,n.height=a),w){let t;try{r.drawImage(e,0,0,e.videoWidth,e.videoHeight,0,0,n.width,n.height),t=r.getImageData(0,0,n.width,n.height),r.clearRect(0,0,n.width,n.height)}catch(e){return void re()}!function(t,i,a){AcuantJavascriptWebSdk.detect(t,i,a,{onSuccess:function(t){if(!n||!e||e.paused||e.ended)return;t.points.forEach((t=>{void 0!==t.x&&void 0!==t.y&&(t.x=t.x/x.frameScale*e.width/e.videoWidth,t.y=t.y/x.frameScale*e.height/e.videoHeight)}));const i=Math.min(t.dimensions.width,t.dimensions.height)/Math.min(n.width,n.height),a=Math.max(t.dimensions.width,t.dimensions.height)/Math.max(n.width,n.height),r=2==t.type;let o=.8,c=.85,l=.6,u=.65;r&&(o=.9,c=.95),E()&&(l=.65,u=.7,z()?r?(o=.72,c=.77,l=.22,u=.28):(o=.41,c=.45,l=.22,u=.28):r&&(o=.95,c=1,l=.7,u=.75));const h=!t.isCorrectAspectRatio||i<l&&a<u,m=i>=o||a>=c;t.type===s.NONE?t.state=d.NO_DOCUMENT:t.state=m?d.BIG_DOCUMENT:h?d.SMALL_DOCUMENT:d.GOOD_DOCUMENT,f(t),y=!1},onFail:function(){if(!n||!e||e.paused||e.ended)return;let t={};t.state=d.NO_DOCUMENT,f(t),y=!1}})}(t,n.width,n.height)}}function ie({image:e,cardType:t,isPortraitOrientation:i},a){n&&r||(n=document.createElement("canvas"),r=n.getContext("2d")),n.width=e.width,n.height=e.height;let o=r.createImageData(e.width,e.height);!function(e,t){for(let i=0;i<e.length;++i)e[i]=t[i]}(o.data,e.data),r.putImageData(o,0,0);let c="AUTO"!=a&&"TAP"!=a;2!==t&&(!c&&i||c&&6===U)&&(r.rotate(Math.PI),r.drawImage(n,0,0,-n.width,-n.height));const d=r.getImageData(0,0,n.width,n.height).data,s="undefined"!=typeof acuantConfig&&"number"==typeof acuantConfig.jpegQuality?acuantConfig.jpegQuality:1,l=n.toDataURL("image/jpeg",s);return r.clearRect(0,0,n.width,n.height),n&&(r=null,n.remove(),n=null),{imageBase64:l,imageBytes:d}}async function ae({dpi:e,cardType:t,sharpness:i,glare:a,moire:n,moireraw:r},o,c){const d=await new Promise((e=>{AcuantJavascriptWebSdk.getCvmlVersion({onSuccess:t=>{e(t)},onFail:()=>{e("unknown")}})})),s=JSON.stringify({cvml:{cropping:{iscropped:!0,dpi:e,idsize:2===t?"ID3":"ID1",elapsed:-1},sharpness:{normalized:i,elapsed:-1},moire:{normalized:n,raw:r,elapsed:-1},glare:{normalized:a,elapsed:-1},version:d},device:{version:ne(),capturetype:o}});return AcuantJavascriptWebSdk.addMetadata(c,{imageDescription:s,dateTimeOriginal:(new Date).toUTCString()})}function ne(){const e=navigator.userAgent;let t,i=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(i[1])?(t=/\brv[ :]+(\d+)/g.exec(e)||[],"IE "+(t[1]||"")):"Chrome"===i[1]&&(t=e.match(/\b(OPR|Edge)\/(\d+)/),null!=t)?t.slice(1).join(" ").replace("OPR","Opera"):(i=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=e.match(/version\/(\d+)/i))&&i.splice(1,1,t[1]),i.join(" "))}function re(){L()||navigator.maxTouchPoints&&navigator.maxTouchPoints>=2&&/MacIntel/.test(navigator.platform)?S(o,AcuantJavascriptWebSdk.SEQUENCE_BREAK_CODE):S(c,AcuantJavascriptWebSdk.SEQUENCE_BREAK_CODE)}function oe(e){let t="";const i=new Uint8Array(e),a=i.byteLength;for(let e=0;e<a;e++)t+=String.fromCharCode(i[e]);return window.btoa(t)}return C})();